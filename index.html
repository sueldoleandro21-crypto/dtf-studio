<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DTF Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#1e1e1e;
  --panel:#252526;
  --border:#333;
  --text:#eaeaea;
  --muted:#999;
  --accent:#3a86ff;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Segoe UI, Inter, sans-serif;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
}

/* TOP BAR */
.topbar{
  height:40px;
  background:#2d2d30;
  display:flex;
  align-items:center;
  padding:0 15px;
  border-bottom:1px solid var(--border);
  font-size:13px;
}

/* MAIN */
.app{
  display:grid;
  grid-template-columns:60px 1fr 260px;
  height:calc(100vh - 40px);
}

/* TOOLS */
.tools{
  background:var(--panel);
  border-right:1px solid var(--border);
}

.tool{
  height:48px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  border-bottom:1px solid #2a2a2a;
  font-size:18px;
}

.tool.active{
  background:var(--accent);
  color:#000;
}

/* WORKSPACE */
.workspace{
  background:#1b1b1b;
  display:flex;
  justify-content:center;
  align-items:center;
}

canvas{
  background:#fff;
  border:1px solid #444;
}

/* PANEL */
.panel{
  background:var(--panel);
  border-left:1px solid var(--border);
  padding:15px;
  font-size:13px;
}

.layer{
  padding:8px;
  border:1px solid var(--border);
  margin-bottom:5px;
  cursor:pointer;
}

.layer.active{
  background:#333;
}

input[type=range], input[type=file]{
  width:100%;
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  DTF Studio Â· Editor Profesional
</div>

<div class="app">

  <!-- TOOLS -->
  <div class="tools">
    <div class="tool active" id="moveTool" title="Mover">ðŸ¡„</div>
    <div class="tool" id="eraseTool" title="Borrar fondo">ðŸ§½</div>
  </div>

  <!-- WORKSPACE -->
  <div class="workspace">
    <canvas id="canvas" width="900" height="550"></canvas>
  </div>

  <!-- PANEL -->
  <div class="panel">
    <h3>Archivos</h3>
    <input type="file" id="upload" accept="image/*" multiple>

    <h3>Capas</h3>
    <div id="layers"></div>

    <h3>Pincel borrador</h3>
    <label>TamaÃ±o</label>
    <input type="range" id="brushSize" min="5" max="80" value="25">

    <h3>Opacidad</h3>
    <input type="range" id="opacity" min="0" max="100" value="100">
  </div>

</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const layersDiv = document.getElementById("layers");

let layers = [];
let activeLayer = null;
let mode = "move";
let dragging = false;
let erasing = false;
let offsetX = 0;
let offsetY = 0;

// Tools
document.getElementById("moveTool").onclick = ()=>setTool("move");
document.getElementById("eraseTool").onclick = ()=>setTool("erase");

function setTool(tool){
  mode = tool;
  document.querySelectorAll(".tool").forEach(t=>t.classList.remove("active"));
  document.getElementById(tool+"Tool").classList.add("active");
}

// Upload images
document.getElementById("upload").addEventListener("change", e=>{
  [...e.target.files].forEach(file=>{
    const reader = new FileReader();
    reader.onload = ev=>{
      const img = new Image();
      img.onload = ()=>{
        const layerCanvas = document.createElement("canvas");
        layerCanvas.width = img.width;
        layerCanvas.height = img.height;
        layerCanvas.getContext("2d").drawImage(img,0,0);

        const layer = {
          canvas: layerCanvas,
          x:(canvas.width-img.width)/2,
          y:(canvas.height-img.height)/2,
          opacity:1
        };

        layers.push(layer);
        activeLayer = layer;
        updateLayers();
        draw();
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });
});

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  layers.forEach(l=>{
    ctx.globalAlpha = l.opacity;
    ctx.drawImage(l.canvas,l.x,l.y);
  });
  ctx.globalAlpha = 1;
}

// Layers UI
function updateLayers(){
  layersDiv.innerHTML = "";
  layers.slice().reverse().forEach(l=>{
    const div = document.createElement("div");
    div.className = "layer"+(l===activeLayer?" active":"");
    div.textContent = "Capa";
    div.onclick = ()=>{
      activeLayer = l;
      document.getElementById("opacity").value = l.opacity*100;
      updateLayers();
    };
    layersDiv.appendChild(div);
  });
}

// Mouse events
canvas.addEventListener("mousedown", e=>{
  if(!activeLayer) return;

  if(mode==="move"){
    dragging = true;
    offsetX = e.offsetX - activeLayer.x;
    offsetY = e.offsetY - activeLayer.y;
  }

  if(mode==="erase"){
    erasing = true;
    erase(e);
  }
});

canvas.addEventListener("mouseup", ()=>{ dragging=false; erasing=false; });
canvas.addEventListener("mouseleave", ()=>{ dragging=false; erasing=false; });

canvas.addEventListener("mousemove", e=>{
  if(dragging && mode==="move"){
    activeLayer.x = e.offsetX - offsetX;
    activeLayer.y = e.offsetY - offsetY;
    draw();
  }
  if(erasing && mode==="erase"){
    erase(e);
  }
});

// Erase function
function erase(e){
  const size = document.getElementById("brushSize").value;
  const x = e.offsetX - activeLayer.x;
  const y = e.offsetY - activeLayer.y;
  const c = activeLayer.canvas.getContext("2d");

  c.globalCompositeOperation = "destination-out";
  c.beginPath();
  c.arc(x,y,size,0,Math.PI*2);
  c.fill();
  c.globalCompositeOperation = "source-over";
  draw();
}

// Opacity
document.getElementById("opacity").addEventListener("input", e=>{
  if(!activeLayer) return;
  activeLayer.opacity = e.target.value/100;
  draw();
});
</script>

</body>
</html>
